<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Curral Bonito</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="bi bi-award-fill text-warning fs-2"></i>
            <h5 class="fw-bold mb-0 mt-2">CURRAL BONITO</h5>
            <small class="text-muted">Gest√£o Rural Pro</small>
        </div>

        <nav class="sidebar-menu">
            <a href="dashboard.html" class="menu-item active">
                <i class="bi bi-speedometer2"></i>
                <span>Dashboard</span>
            </a>
            <a href="rebanho.html" class="menu-item">
                <i class="bi bi-clipboard-data"></i>
                <span>Rebanho</span>
            </a>
            <a href="pesagem.html" class="menu-item">
                <i class="bi bi-speedometer"></i>
                <span>Pesagem</span>
            </a>
            <a href="pastagens.html" class="menu-item">
                <i class="bi bi-grid-3x3-gap"></i>
                <span>Pastagens</span>
            </a>
            <a href="leite.html" class="menu-item">
                <i class="bi bi-droplet"></i>
                <span>Produ√ß√£o Leite</span>
            </a>
            <a href="genealogia.html" class="menu-item">
                <i class="bi bi-diagram-3"></i>
                <span>Genealogia</span>
            </a>
            <a href="inseminacao.html" class="menu-item">
                <i class="bi bi-heart-pulse"></i>
                <span>Insemina√ß√£o</span>
            </a>
            <a href="sanitario.html" class="menu-item">
                <i class="bi bi-prescription2"></i>
                <span>Sanit√°rio</span>
            </a>
            <a href="alimentacao.html" class="menu-item">
                <i class="bi bi-basket"></i>
                <span>Alimenta√ß√£o</span>
            </a>
            <a href="financeiro.html" class="menu-item">
                <i class="bi bi-cash-coin"></i>
                <span>Financeiro</span>
            </a>
            <a href="relatorios.html" class="menu-item">
                <i class="bi bi-graph-up"></i>
                <span>Relat√≥rios</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="btn btn-danger w-100" id="logout-btn">
                <i class="bi bi-box-arrow-right me-2"></i>Sair
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="topbar">
            <button class="btn btn-primary" id="toggle-sidebar">
                <i class="bi bi-list fs-4"></i>
            </button>
            <div class="ms-auto d-flex align-items-center">
                <span class="me-3">Bem-vindo, <strong id="username-display"></strong>!</span>
                <i class="bi bi-person-circle fs-3 text-primary"></i>
            </div>
        </div>

        <!-- Content -->
        <div class="content-area">
            <div class="page-header">
                <h1 class="fw-bold">
                    <i class="bi bi-speedometer2 text-primary"></i>
                    Dashboard Principal
                </h1>
                <p class="text-muted">Vis√£o geral completa da sua propriedade rural</p>
            </div>

            <!-- Tutorial -->
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                <h5 class="alert-heading"><i class="bi bi-lightbulb-fill me-2"></i>Como Usar o Sistema</h5>
                <p class="mb-2"><strong>1.</strong> Use o <strong>menu lateral</strong> para navegar entre as p√°ginas</p>
                <p class="mb-2"><strong>2.</strong> Comece cadastrando seus animais na p√°gina <strong>"Rebanho"</strong></p>
                <p class="mb-2"><strong>3.</strong> Registre o peso dos animais em <strong>"Pesagem"</strong> para calcular UA corretamente</p>
                <p class="mb-2"><strong>4.</strong> Configure seus <strong>"Piquetes/Pastagens"</strong> para controlar lota√ß√£o</p>
                <p class="mb-2"><strong>5.</strong> Todos os dados s√£o <strong>criptografados</strong> e salvos com seguran√ßa</p>
                <p class="mb-0"><strong>üìä</strong> Acesse <strong>"Relat√≥rios"</strong> para ver indicadores completos!</p>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Cards de Resumo -->
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card bg-primary">
                        <div class="card-icon">
                            <i class="bi bi-clipboard-data"></i>
                        </div>
                        <div>
                            <h3 class="mb-0" id="total-animais">0</h3>
                            <p class="mb-0">Total de Animais</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card bg-success">
                        <div class="card-icon">
                            <i class="bi bi-rulers"></i>
                        </div>
                        <div>
                            <h3 class="mb-0" id="total-ua">0.0</h3>
                            <p class="mb-0">Unidades Animais (UA)</p>
                            <small class="opacity-75">1 UA = 450kg</small>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card bg-warning">
                        <div class="card-icon">
                            <i class="bi bi-cash-stack"></i>
                        </div>
                        <div>
                            <h3 class="mb-0" id="saldo-total">R$ 0,00</h3>
                            <p class="mb-0">Saldo Financeiro</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card bg-danger">
                        <div class="card-icon">
                            <i class="bi bi-heart-pulse"></i>
                        </div>
                        <div>
                            <h3 class="mb-0" id="total-inseminacoes">0</h3>
                            <p class="mb-0">Insemina√ß√µes Ativas</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card bg-info">
                        <div class="card-icon">
                            <i class="bi bi-droplet-fill"></i>
                        </div>
                        <div>
                            <h3 class="mb-0" id="prod-leite-mes">0</h3>
                            <p class="mb-0">Prod. Leite (M√™s) em Litros</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card bg-dark">
                        <div class="card-icon">
                            <i class="bi bi-speedometer2"></i>
                        </div>
                        <div>
                            <h3 class="mb-0" id="peso-medio">0</h3>
                            <p class="mb-0">Peso M√©dio (kg)</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card bg-secondary">
                        <div class="card-icon">
                            <i class="bi bi-prescription2"></i>
                        </div>
                        <div>
                            <h3 class="mb-0" id="manejos-sanitarios">0</h3>
                            <p class="mb-0">Manejos Sanit√°rios</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card bg-success">
                        <div class="card-icon">
                            <i class="bi bi-grid-3x3-gap"></i>
                        </div>
                        <div>
                            <h3 class="mb-0" id="total-piquetes-dash">0</h3>
                            <p class="mb-0">Piquetes Cadastrados</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alertas e Pr√≥ximos Eventos -->
            <div class="row g-4 mt-4">
                <div class="col-lg-6">
                    <div class="card shadow-sm">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0"><i class="bi bi-exclamation-triangle-fill me-2"></i>Alertas Importantes</h5>
                        </div>
                        <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                            <div id="alertas-sanitarios">
                                <p class="text-muted">Nenhum alerta no momento</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="card shadow-sm">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="bi bi-calendar-event me-2"></i>Pr√≥ximos Eventos</h5>
                        </div>
                        <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                            <div id="proximos-eventos">
                                <p class="text-muted">Nenhum evento programado</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Atalhos R√°pidos -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="bi bi-lightning-fill me-2"></i>A√ß√µes R√°pidas</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <a href="rebanho.html" class="btn btn-outline-primary w-100">
                                        <i class="bi bi-plus-circle me-2"></i>Cadastrar Animal
                                    </a>
                                </div>
                                <div class="col-md-3">
                                    <a href="pesagem.html" class="btn btn-outline-success w-100">
                                        <i class="bi bi-speedometer me-2"></i>Registrar Pesagem
                                    </a>
                                </div>
                                <div class="col-md-3">
                                    <a href="sanitario.html" class="btn btn-outline-warning w-100">
                                        <i class="bi bi-prescription2 me-2"></i>Manejo Sanit√°rio
                                    </a>
                                </div>
                                <div class="col-md-3">
                                    <a href="financeiro.html" class="btn btn-outline-danger w-100">
                                        <i class="bi bi-cash me-2"></i>Lan√ßamento Financeiro
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const stats = DataManager.getDashboardStats();
            const sanitarios = DataManager.getSanitarios();
            const inseminacoes = DataManager.getInseminacoes();
            const pastagens = DataManager.getPastagens();
            
            document.getElementById('total-animais').textContent = stats.totalAnimais;
            document.getElementById('total-ua').textContent = stats.totalUA + ' UA';
            document.getElementById('saldo-total').textContent = stats.saldoTotal;
            document.getElementById('total-inseminacoes').textContent = stats.totalInseminacoes;
            document.getElementById('prod-leite-mes').textContent = stats.producaoLeiteMes;
            document.getElementById('peso-medio').textContent = stats.pesoMedioRebanho;
            document.getElementById('manejos-sanitarios').textContent = sanitarios.length;
            document.getElementById('total-piquetes-dash').textContent = pastagens.length;

            // Pr√≥ximos eventos
            const hoje = new Date();
            const em30dias = new Date(hoje.getTime() + (30 * 24 * 60 * 60 * 1000));
            
            const partosProximos = inseminacoes.filter(i => {
                if (!i.previsaoParto || i.status !== 'Confirmada') return false;
                const dataParto = new Date(i.previsaoParto);
                return dataParto >= hoje && dataParto <= em30dias;
            });

            const divEventos = document.getElementById('proximos-eventos');
            if (partosProximos.length > 0) {
                divEventos.innerHTML = partosProximos.map(p => `
                    <div class="alert alert-info mb-2">
                        <strong>Parto Previsto:</strong> Vaca ${p.animalId} - ${DataManager.formatarData(p.previsaoParto)}
                    </div>
                `).join('');
            }

            // Alertas sanit√°rios
            const alertasSanit = sanitarios.filter(s => {
                if (!s.proximaDose) return false;
                const dataProxima = new Date(s.proximaDose);
                return dataProxima >= hoje && dataProxima <= em30dias;
            });

            const divAlertas = document.getElementById('alertas-sanitarios');
            if (alertasSanit.length > 0) {
                divAlertas.innerHTML = alertasSanit.map(a => `
                    <div class="alert alert-warning mb-2">
                        <strong>${a.produto}:</strong> Animal ${a.animalId} - ${DataManager.formatarData(a.proximaDose)}
                    </div>
                `).join('');
            }
        });
    </script>
</body>
</html>